<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebAR Image Tracking</title>
    
    <script>
        console.log("üîµ –ó–∞–≥—Ä—É–∑–∫–∞ A-Frame –∏ MindAR...");
    </script>

    <script src="https://aframe.io/releases/1.6.0/aframe.min.js" onerror="console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ aframe.min.js')"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.0/dist/mindar-image-aframe.prod.js" onerror="console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ mindar-image-aframe.prod.js')"></script>

    <style>
        /* –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º */
        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }

        a-scene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw !important;
            height: 100vh !important;
        }

        /* –ö–Ω–æ–ø–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∑–≤—É–∫–∞ */
        #start-video {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 100;
            padding: 10px 20px;
            font-size: 16px;
            background: #ff5722;
            color: white;
            border: none;
            cursor: pointer;
            display: block;
        }
    </style>
</head>
<body>
    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤–∏–¥–µ–æ —Å–æ –∑–≤—É–∫–æ–º -->
    <button id="start-video">–í–∫–ª—é—á–∏—Ç—å –≤–∏–¥–µ–æ</button>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            console.log("‚úÖ DOM –∑–∞–≥—Ä—É–∂–µ–Ω");
        });


navigator.mediaDevices.getUserMedia({ 
    video: { width: { ideal: 1920 }, height: { ideal: 1080 } }
}).then((stream) => {
    console.log("‚úÖ –ö–∞–º–µ—Ä–∞ —Å –≤—ã—Å–æ–∫–∏–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞");
}).catch((err) => console.error("‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ:", err));

        AFRAME.registerComponent('debugger', {
            init: function () {
                console.log("üü° –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è A-Frame...");
                this.el.sceneEl.addEventListener('loaded', () => {
                    console.log("‚úÖ A-Frame —Å—Ü–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞");
                });
            }
        });

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å–∞–π–∑ —Å—Ü–µ–Ω—ã
        window.addEventListener("resize", () => {
            const scene = document.querySelector("a-scene");
            if (scene) {
                scene.style.width = `${window.innerWidth}px`;
                scene.style.height = `${window.innerHeight}px`;
            }
        });
    </script>

    <a-scene mindar-image="imageTargetSrc: ./assets/targets.mind;" embedded debugger>
        <a-camera mindar-camera="true" position="0 0 0" look-controls-enabled="false" cursor="rayOrigin: mouse"></a-camera>

        <a-assets>
            <video id="video1" src="video1.mp4" preload="auto" playsinline></video>
            <video id="video2" src="video2.mp4" loop playsinline></video>
        </a-assets>

        <a-entity mindar-image-targets>
            <!-- –ü–µ—Ä–≤—ã–π –º–∞—Ä–∫–µ—Ä -->
            <a-entity mindar-image-target="targetIndex: 0">
                <a-video id="video1-entity" src="#video1" position="0 0 0" width="1" height="0.60" rotation="0 0 0"></a-video>
            </a-entity>

            <!-- –í—Ç–æ—Ä–æ–π –º–∞—Ä–∫–µ—Ä -->
            <a-entity mindar-image-target="targetIndex: 1">
                <a-video id="video2-entity" src="#video2" position="0 0 0" width="1.77" height="1" rotation="0 0 90"></a-video>
            </a-entity>
        </a-entity>
    </a-scene>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            console.log("üü° –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏–¥–µ–æ...");

            const video1 = document.getElementById("video1");
            const video2 = document.getElementById("video2");

            video1.oncanplay = () => console.log("‚úÖ –í–∏–¥–µ–æ 1 –∑–∞–≥—Ä—É–∂–µ–Ω–æ");
            video2.oncanplay = () => console.log("‚úÖ –í–∏–¥–µ–æ 2 –∑–∞–≥—Ä—É–∂–µ–Ω–æ");

            const marker1 = document.querySelector('[mindar-image-target="targetIndex: 0"]');
            const marker2 = document.querySelector('[mindar-image-target="targetIndex: 1"]');

            marker1.addEventListener("targetFound", () => {
                console.log("‚úÖ –ú–∞—Ä–∫–µ—Ä 1 –Ω–∞–π–¥–µ–Ω! –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –≤–∏–¥–µ–æ 1...");
                video1.muted = false;
                video1.play();
            });

            marker1.addEventListener("targetLost", () => {
                console.log("üõë –ú–∞—Ä–∫–µ—Ä 1 –ø–æ—Ç–µ—Ä—è–Ω! –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥–µ–æ 1...");
                video1.pause();
            });

            marker2.addEventListener("targetFound", () => {
                console.log("‚úÖ –ú–∞—Ä–∫–µ—Ä 2 –Ω–∞–π–¥–µ–Ω! –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –≤–∏–¥–µ–æ 2...");
                video2.muted = false;
                video2.play();
            });

            marker2.addEventListener("targetLost", () => {
                console.log("üõë –ú–∞—Ä–∫–µ—Ä 2 –ø–æ—Ç–µ—Ä—è–Ω! –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥–µ–æ 2...");
                video2.pause();
            });

            // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏–¥–µ–æ –ø–æ –∫–Ω–æ–ø–∫–µ –¥–ª—è iOS
            document.getElementById("start-video").addEventListener("click", () => {
                console.log("üéµ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –∑–≤—É–∫ –ø–æ–ª—É—á–µ–Ω–æ!");
                video1.muted = false;
                video2.muted = false;

                video1.play().catch(err => console.error("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤–∏–¥–µ–æ 1:", err));
                video2.play().catch(err => console.error("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤–∏–¥–µ–æ 2:", err));

                document.getElementById("start-video").style.display = "none"; // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è
            });
        });
    </script>
</body>
</html>
